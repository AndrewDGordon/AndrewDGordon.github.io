!function(){"use strict";var t={93501:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.logMessage=e.increment=e.currentTime=e.clock=e.add=void 0;var i="foo"+n(6229).y;function a(t,e){return t+e+i.length}function s(t){var e=setInterval((function(){var e=c();t.setResult(e)}),1e3);t.onCanceled=function(){clearInterval(e)}}function c(){return(new Date).toLocaleTimeString()}function u(t,e){var n=0,r=setInterval((function(){n+=t,e.setResult(n)}),1e3);e.onCanceled=function(){clearInterval(r)}}function l(t){return console.log(t),t}e.add=a,e.clock=s,e.currentTime=c,e.increment=u,e.logMessage=l;var p={type:"Error",basicType:"Error",basicValue:"#NULL!"};function d(t){return{type:"String",basicValue:t}}function g(t){return{type:"Double",basicValue:t}}function h(t){return 0==t.length?p:{type:"Array",elements:t}}var f={},v=Promise.resolve([]);function m(t){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){return e=v.then((function(){return function(t){return r(this,void 0,void 0,(function(){var e,n,r,i,a,s,c,u;return o(this,(function(o){switch(o.label){case 0:if(e={method:"GET"},f[t])return console.log("Cache hit for ".concat(t)),[2,f[t]];n=[],r=0,i=t,o.label=1;case 1:return null===i?[3,5]:(a=Date.now(),[4,new Promise((function(t){return setTimeout(t,600)}))]);case 2:return o.sent(),[4,fetch(i,e)];case 3:return(s=o.sent()).ok?[4,s.json()]:(console.error("Error! status: ".concat(s.status)),i=null,[3,1]);case 4:return c=o.sent(),u=Date.now(),r+=1,console.log("Fetched page ".concat(r," in ").concat((u-a)/1e3,"s from ").concat(i," count ").concat(c.count)),n.push.apply(n,c.results),i=c.next||null,[3,1];case 5:return f[t]=n,[2,n]}}))}))}(t)})),v=e.catch((function(){return new Error("Error: unexpected exception")})),[2,e]}))}))}var y={description:"360Giving",logoSourceAddress:"https://www.threesixtygiving.org/wp-content/themes/360giving2020/assets/images/360-logos/360giving-main.svg",logoTargetAddress:"https://360Giving.org"};function w(t){var e=new Date(t);return{type:"FormattedNumber",basicValue:25569+(e.getTime()-60*e.getTimezoneOffset()*1e3)/864e5,numberFormat:"yyyy-mm-dd"}}function b(t,e){return{type:"FormattedNumber",basicValue:t,numberFormat:"GBP"==e?"Â£* #,##0.00":"* #,##0.00",propertyMetadata:{sublabel:e}}}function E(t){var e=t.data,n=b(e.amountAwarded,e.currency),r=e.fundingOrganization.map((function(t){return t.name})).join(","),o=e.recipientOrganization.map((function(t){return t.name})).join(","),i=e.fundingOrganization.map((function(t){return t.id})).join(","),a=e.recipientOrganization.map((function(t){return t.id})).join(",");return{type:"Entity",text:e.title,properties:{title:e.title,awardDate:w(e.awardDate),funder:r,recipient:o,amountAwarded:n,description:e.description,grant_id:t.grant_id,funder_id:i,recipient_id:a,grant_nav:"https://grantnav.threesixtygiving.org/grant/"+t.grant_id,raw_grant_data:_(t)},layouts:{compact:{icon:"Gift"},card:{title:{property:"title"},sections:[{layout:"List",properties:["awardDate","funder","recipient","amountAwarded","description"]},{layout:"List",title:"More",properties:["grant_id","funder_id","recipient_id","grant_nav","raw_grant_data"],collapsible:!0,collapsed:!0}]}},provider:{description:e.title+" on 360Giving GrantNav",logoSourceAddress:"https://www.threesixtygiving.org/wp-content/themes/360giving2020/assets/images/360-logos/360giving-main.svg",logoTargetAddress:"https://grantnav.threesixtygiving.org/grant/"+t.grant_id}}}function _(t){if(null==t)return p;switch(typeof t){case"boolean":return{type:"Boolean",basicValue:t};case"string":return{type:"String",basicValue:t};case"number":return{type:"Double",basicValue:t};case"object":if(t.constructor===Array){var e=t.length;if(0==e)return p;for(var n=new Array(e),r=0;r<e;r++)n[r]=[T(t[r])];return h(n)}var o=t,i="",a={};for(var s in o)if(o.hasOwnProperty(s)){for(var c=s.toLowerCase();a.hasOwnProperty(c);)c+="9";var u=o[s];a[c]=_(u);var l=typeof u,d=c+("boolean"===l||"number"===l||"string"===l?"="+u.toString():"");i=""==i?d:i+","+d}return{type:"Entity",text:i,properties:a};default:return{type:"String",basicValue:"DEFAULT - unexpected"}}}function T(t){if(null==t)return p;var e=_(t);return"object"==typeof t&&t.constructor===Array?{type:"Entity",text:"Nested array",properties:{array:e}}:e}CustomFunctions.associate("ADD",a),CustomFunctions.associate("CLOCK",s),CustomFunctions.associate("INCREMENT",u),CustomFunctions.associate("LOG",l),CustomFunctions.associate("GRANTS_RECEIVED",(function(t){return r(this,void 0,void 0,(function(){var e,n;return o(this,(function(r){switch(r.label){case 0:return[4,m("https://api.threesixtygiving.org/api/v1/org/"+t+"/grants_received/?limit=100")];case 1:return(e=r.sent())instanceof Error?[2,{type:"Entity",text:"".concat(t," not known to have received grants"),properties:{error:e.message},provider:y}]:(n=e,[2,{type:"Entity",text:"".concat(t," received ").concat(e.length," grants"),properties:{grants:h(n.map((function(t){return[E(t)]})))},provider:{description:"".concat(t," on 360Giving"),logoSourceAddress:"https://www.threesixtygiving.org/wp-content/themes/360giving2020/assets/images/360-logos/360giving-main.svg",logoTargetAddress:"https://grantnav.threesixtygiving.org/org/"+t}}])}}))}))})),CustomFunctions.associate("GRANTS_MADE",(function(t){return r(this,void 0,void 0,(function(){var e,n;return o(this,(function(r){switch(r.label){case 0:return[4,m("https://api.threesixtygiving.org/api/v1/org/"+t+"/grants_made/?limit=100")];case 1:return(e=r.sent())instanceof Error?[2,{type:"Entity",text:"".concat(t," not known to have made grants"),properties:{error:e.message},provider:y}]:(n=e,[2,{type:"Entity",text:"".concat(t," made ").concat(e.length," grants"),properties:{grants:h(n.map((function(t){return[E(t)]})))},provider:{description:"".concat(t," on 360Giving"),logoSourceAddress:"https://www.threesixtygiving.org/wp-content/themes/360giving2020/assets/images/360-logos/360giving-main.svg",logoTargetAddress:"https://grantnav.threesixtygiving.org/org/"+t}}])}}))}))})),CustomFunctions.associate("WHO_FUNDS_WITH_WHO",(function(t){return r(this,void 0,void 0,(function(){var e,n,r,i,a,s,c,u,l,p,f,v,m,y,w,b,E;return o(this,(function(o){for(e=[],n=t.length,r=0;r<n;r++)for(i=t[r][0],E=i.split(";"),c=0;c<E.length;c++)for(a=0;a<E.length;a++)c!==a&&e.push([d(E[c]),d(E[a])]);for(s={},c=0;c<e.length;c++)u=e[c],l=u[0],p=u[1],w=l.basicValue+";"+p.basicValue,s[w]=(s[w]||0)+1;for(f=[],v=0,m=Object.entries(s);v<m.length;v++)y=m[v],w=y[0],b=y[1],E=w.split(";"),f.push([d(E[0]),d(E[1]),g(b)]);return[2,{type:"Entity",text:"Who funds with who",properties:{who_funds_with_who:h(f)}}]}))}))})),CustomFunctions.associate("FINDTHATCHARITY",(function(t){return r(this,void 0,void 0,(function(){var e,n,r,i;return o(this,(function(o){switch(o.label){case 0:return e="https://findthatcharity.uk/orgid/"+t,[4,fetch(e+".json",{method:"GET"})];case 1:return(n=o.sent()).ok?[4,n.json()]:[2,"Error! status: ".concat(n.status)];case 2:return r=o.sent(),console.log(r),i=function(t,e){return{type:"Entity",text:e.name,properties:{name:e.name,organisationTypePrimary:e.organisationTypePrimary,description:_(e.description),latestFinancialYearEnd:w(e.latestFinancialYearEnd),latestIncome:null==e.latestIncome?p:b(e.latestIncome,"GBP"),latestSpending:null==e.latestSpending?p:b(e.latestSpending,"GBP"),latestEmployees:_(e.latestEmployees),latestVolunteers:_(e.latestVolunteers),trusteeCount:_(e.trusteeCount),telephone:_(e.telephone),email:_(e.email),location:e.location.map((function(t){return t.name})).join(","),address:e.address.streetAddress+", "+e.address.addressLocality+", "+e.address.postalCode,url:_(e.url),id:e.id,charityNumber:_(e.charityNumber),companyNumber:_(e.companyNumber),active:{type:"Boolean",basicValue:e.active},dateRegistered:w(e.dateRegistered),dateRemoved:null==e.dateRemoved?"not applicable":w(e.dateRemoved),parent:_(e.parent),organisationType:e.organisationType.join(","),alternateName:e.alternateName.join(","),sources:e.sources.join(","),links:e.links.map((function(t){return t.site+": "+t.url})).join(","),orgIDs:e.orgIDs.join(","),linked_records:e.linked_records.map((function(t){return t.orgid+": "+t.url})).join(","),dateModified:w(e.dateModified),raw_charity_data:_(e)},layouts:{compact:{icon:"Organization"},card:{title:{property:"name"},sections:[{layout:"List",properties:["description"]},{layout:"List",title:"".concat(e.active?"Active":"Inactive"," ").concat(e.organisationTypePrimary,", number ").concat(e.charityNumber," since ").concat(e.dateRegistered),properties:["id","charityNumber","companyNumber","organisationTypePrimary","active","dateRegistered","dateRemoved","parent","organisationType","alternateName"],collapsible:!0,collapsed:!0},{layout:"List",title:"People and Financials",properties:["latestFinancialYearEnd","latestIncome","latestSpending","latestEmployees","latestVolunteers","trusteeCount"],collapsible:!0,collapsed:!1},{layout:"List",title:"Contact",properties:["telephone","email","address","url"],collapsible:!0,collapsed:!1},{layout:"List",title:"More",properties:["sources","location","links","orgIDs","linked_records","dateModified","raw_charity_data"],collapsible:!0,collapsed:!0}]}},provider:{description:e.name+" on FindThatCharity",logoSourceAddress:"https://www.threesixtygiving.org/wp-content/themes/360giving2020/assets/images/360-logos/360giving-main.svg",logoTargetAddress:t}}}(e,r),[2,i]}}))}))})),CustomFunctions.associate("STRING_TO_DATE",w),CustomFunctions.associate("GET_JSON",(function(t){return r(this,void 0,void 0,(function(){var e,n,r;return o(this,(function(o){switch(o.label){case 0:e={method:"GET"},o.label=1;case 1:return o.trys.push([1,4,,5]),[4,fetch(t,e)];case 2:if(!(n=o.sent()).ok)throw new Error("Error! status: ".concat(n.status));return[4,n.json()];case 3:return[2,_(o.sent())];case 4:return r=o.sent(),console.log(r),[2,_("caught: "+r.message)];case 5:return[2]}}))}))})),CustomFunctions.associate("GET_JSON_LINES",(function(t){return r(this,void 0,void 0,(function(){var e,n,r,i,a,s,c,u;return o(this,(function(o){switch(o.label){case 0:e={method:"GET"},o.label=1;case 1:return o.trys.push([1,5,,6]),[4,fetch(t,e)];case 2:if(!(n=o.sent()).ok)throw new Error("Error! status: ".concat(n.status));return[4,n.text()];case 3:return[4,o.sent().split("\n")];case 4:for(r=o.sent(),i=r.length-1,a=new Array(i),s=0;s<i;s++){c=r[s];try{a[s]=JSON.parse(r[s])}catch(t){a[s]="error parsing: "+c+"length "+c.length}}return[2,_({lines:a})];case 5:return u=o.sent(),console.log(u),[2,_("caught: "+u.message)];case 6:return[2]}}))}))})),CustomFunctions.associate("POST_JSON",(function(t,e){return r(this,void 0,void 0,(function(){var n,r,i;return o(this,(function(o){switch(o.label){case 0:n={method:"POST",headers:{"Content-Type":"application/json"},body:e},o.label=1;case 1:return o.trys.push([1,4,,5]),[4,fetch(t,n)];case 2:if(!(r=o.sent()).ok)throw new Error("Error! status: ".concat(r.status));return[4,r.json()];case 3:return[2,_(o.sent())];case 4:return i=o.sent(),console.log(i),[2,_("caught: "+i.message)];case 5:return[2]}}))}))})),CustomFunctions.associate("ENCODEURI",(function(t){return encodeURIComponent(t)})),CustomFunctions.associate("PARSE_JSON",(function(t){return _(JSON.parse(t))}))},6229:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.y=void 0,e.y="hello"}},e={};!function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}(93501)}();
//# sourceMappingURL=functions.js.map