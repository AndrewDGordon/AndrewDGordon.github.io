!function(){"use strict";var e={36133:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(6229),a=r(6229),s={},c=Promise.resolve([]);function u(e){return n(this,void 0,void 0,(function(){var t;return o(this,(function(r){return t=c.then((function(){return function(e){return n(this,void 0,void 0,(function(){var t,r,n,i,a,c,u,l;return o(this,(function(o){switch(o.label){case 0:if(t={method:"GET"},s[e])return console.log("Cache hit for ".concat(e)),[2,s[e]];r=[],n=0,i=e,o.label=1;case 1:return null===i?[3,5]:(a=Date.now(),[4,new Promise((function(e){return setTimeout(e,600)}))]);case 2:return o.sent(),[4,fetch(i,t)];case 3:return(c=o.sent()).ok?[4,c.json()]:(console.error("Error! status: ".concat(c.status)),i=null,[3,1]);case 4:return u=o.sent(),l=Date.now(),n+=1,console.log("Fetched page ".concat(n," in ").concat((l-a)/1e3,"s from ").concat(i," count ").concat(u.count)),r.push.apply(r,u.results),i=u.next||null,[3,1];case 5:return s[e]=r,[2,r]}}))}))}(e)})),c=t.catch((function(){return new Error("Error: unexpected exception")})),[2,t]}))}))}var l={description:"360Giving",logoSourceAddress:"https://www.threesixtygiving.org/wp-content/themes/360giving2020/assets/images/360-logos/360giving-main.svg",logoTargetAddress:"https://360Giving.org"};function p(e){var t=e.data,r=(0,a.number_to_amount)(t.amountAwarded,t.currency),n=t.fundingOrganization.map((function(e){return e.name})).join(","),o=t.recipientOrganization.map((function(e){return e.name})).join(","),s=t.fundingOrganization.map((function(e){return e.id})).join(","),c=t.recipientOrganization.map((function(e){return e.id})).join(",");return{type:"Entity",basicType:"Error",basicValue:"#VALUE!",text:t.title,properties:{title:(0,i.mk_ExcelString)(t.title),awardDate:(0,a.string_to_date)(t.awardDate),funder:(0,i.mk_ExcelString)(n),recipient:(0,i.mk_ExcelString)(o),amountAwarded:r,description:(0,i.mk_ExcelString)(t.description),grant_id:(0,i.mk_ExcelString)(e.grant_id),funder_id:(0,i.mk_ExcelString)(s),recipient_id:(0,i.mk_ExcelString)(c),grant_nav:(0,i.mk_ExcelString)("https://grantnav.threesixtygiving.org/grant/"+e.grant_id)},layouts:{compact:{icon:"Gift"},card:{title:{property:"title"},sections:[{layout:"List",properties:["awardDate","funder","recipient","amountAwarded","description"]},{layout:"List",title:"More",properties:["grant_id","funder_id","recipient_id","grant_nav"],collapsible:!0,collapsed:!0}]}},provider:{description:t.title+" on 360Giving GrantNav",logoSourceAddress:"https://www.threesixtygiving.org/wp-content/themes/360giving2020/assets/images/360-logos/360giving-main.svg",logoTargetAddress:"https://grantnav.threesixtygiving.org/grant/"+e.grant_id}}}function g(e){return null!==e&&"object"==typeof e&&"type"in e&&"Array"===e.type}function d(e){return null!==e&&"object"==typeof e&&"type"in e&&"Entity"===e.type}CustomFunctions.associate("GRANTS_RECEIVED",(function(e){return n(this,void 0,void 0,(function(){var t,r;return o(this,(function(n){switch(n.label){case 0:return[4,u("https://api.threesixtygiving.org/api/v1/org/"+e+"/grants_received/?limit=100")];case 1:return(t=n.sent())instanceof Error?[2,{type:"Entity",text:"".concat(e," not known to have received grants"),properties:{error:t.message},provider:l}]:(r=t,[2,{type:"Entity",text:"".concat(e," received ").concat(t.length," grants"),properties:{grants:(0,i.mk_ExcelArray)(r.map((function(e){return[p(e)]})))},provider:{description:"".concat(e," on 360Giving"),logoSourceAddress:"https://www.threesixtygiving.org/wp-content/themes/360giving2020/assets/images/360-logos/360giving-main.svg",logoTargetAddress:"https://grantnav.threesixtygiving.org/org/"+e}}])}}))}))})),CustomFunctions.associate("GRANTS_MADE",(function(e){return n(this,void 0,void 0,(function(){var t,r;return o(this,(function(n){switch(n.label){case 0:return[4,u("https://api.threesixtygiving.org/api/v1/org/"+e+"/grants_made/?limit=100")];case 1:return(t=n.sent())instanceof Error?[2,{type:"Entity",text:"".concat(e," not known to have made grants"),properties:{error:t.message},provider:l}]:(r=t,[2,{type:"Entity",text:"".concat(e," made ").concat(t.length," grants"),properties:{grants:(0,i.mk_ExcelArray)(r.map((function(e){return[p(e)]})))},provider:{description:"".concat(e," on 360Giving"),logoSourceAddress:"https://www.threesixtygiving.org/wp-content/themes/360giving2020/assets/images/360-logos/360giving-main.svg",logoTargetAddress:"https://grantnav.threesixtygiving.org/org/"+e}}])}}))}))})),CustomFunctions.associate("ALLGRANTS",(function(e){try{for(var t=[],r=0;r<e.length;r++)for(var n=0;n<e[r].length;n++){var o=e[r][n];if(d(o)&&"grants"in o.properties){var i=o.properties.grants;if(g(i))for(var a=i.elements.length,s=0;s<a;s++){var c=i.elements[s][0];d(c)&&"grant_id"in c.properties&&t.push(c)}}}if(0===t.length)return[[{type:"String",basicValue:"No grants found"}]];var u=t.map((function(e){return[e]}));return u}catch(e){return[[{type:"String",basicValue:"Error! ".concat(e.message)}]]}})),CustomFunctions.associate("WHO_FUNDS_WITH_WHO",(function(e){try{for(var t=[],r=0;r<e.length;r++)for(var n=0;n<e[r].length;n++){var o=e[r][n];if(d(o)&&"grants"in o.properties){var i=o.properties.grants;if(g(i))for(var a=i.elements.length,s=0;s<a;s++)d(l=i.elements[s][0])&&"grant_id"in l.properties&&t.push(l)}}var c={},u=[];for(r=0;r<t.length;r++){var l,p=(l=t[r]).properties.grant_id,f=l.properties.funder_id,h=l.properties.recipient_id;u.push({grant_id:p.basicValue,funder_id:f.basicValue,recipient_id:h.basicValue});var v=l.properties.funder,y=l.properties.recipient;c[f.basicValue]=v.basicValue,c[h.basicValue]=y.basicValue}Array.from(new Set(u.map((function(e){return e.funder_id}))));var m=Array.from(new Set(u.map((function(e){return e.recipient_id})))),_={};for(r=0;r<m.length;r++)_[m[r]]=new Set;for(r=0;r<u.length;r++){var b=u[r];_[b.recipient_id].add(b.funder_id)}var E={};for(s=0;s<m.length;s++){var w=_[y=m[s]],x=Array.from(w);for(r=0;r<x.length;r++)for(n=0;n<x.length;n++)r!==n&&(E[V=x[r]+";"+x[n]]=(E[V]||0)+1)}for(var S=[],k=0,T=Object.entries(E);k<T.length;k++){var A=T[k],V=A[0],N=A[1],C=V.split(";");S.push([{type:"String",basicValue:c[C[0]]},{type:"String",basicValue:c[C[1]]},{type:"Double",basicValue:N}])}return S.sort((function(e,t){return t[2].basicValue-e[2].basicValue})),S}catch(e){return[[{type:"String",basicValue:"Error! ".concat(e.message)}]]}}))},80490:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(6229),a=r(6229),s=Promise.resolve({});function c(e){return n(this,void 0,void 0,(function(){var t;return o(this,(function(r){return t=s.then((function(){return function(e){return n(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return[4,new Promise((function(e){return setTimeout(e,200)}))];case 1:return r.sent(),[4,fetch(e,{method:"GET"})];case 2:return(t=r.sent()).ok?[4,t.json()]:(console.error("Error! status: ".concat(t.status)),[2,new Error("Error! status: ".concat(t.status))]);case 3:return[2,r.sent()]}}))}))}(e)})),s=t.catch((function(){return new Error("Error: unexpected exception")})),[2,t]}))}))}var u={description:"FindThatCharity",logoSourceAddress:"https://www.threesixtygiving.org/wp-content/themes/360giving2020/assets/images/360-logos/360giving-main.svg",logoTargetAddress:"https://findthatcharity.uk"},l={};CustomFunctions.associate("FINDTHATCHARITYTEST",(function(e){return n(this,void 0,void 0,(function(){var t,r;return o(this,(function(n){switch(n.label){case 0:return[4,c("https://findthatcharity.uk/orgid/"+e+".json")];case 1:return t=n.sent(),r=t.name,[2,{type:"Entity",text:"findThatCharity ".concat(r),properties:{charity_or_error:r}}]}}))}))})),CustomFunctions.associate("FINDTHATCHARITY",(function(e){return n(this,void 0,void 0,(function(){var t,r,n;return o(this,(function(o){switch(o.label){case 0:return l[e]?(console.log("Cache hit for ".concat(e)),[2,l[e]]):[4,c((t="https://findthatcharity.uk/orgid/"+e)+".json")];case 1:return(r=o.sent())instanceof Error?[2,{type:"Entity",text:"".concat(e," not found on FindThatCharity"),properties:{error:r.message},provider:u}]:(n=function(e,t){return{type:"Entity",basicType:"Error",basicValue:"#VALUE!",text:t.name,properties:{name:(0,i.mk_ExcelString)(t.name),organisationTypePrimary:(0,i.mk_ExcelString)(t.organisationTypePrimary),description:(0,a.value_to_excel)(t.description),latestFinancialYearEnd:(0,a.string_to_date)(t.latestFinancialYearEnd),latestIncome:null==t.latestIncome?i.nullErrorValue:(0,a.number_to_amount)(t.latestIncome,"GBP"),latestSpending:null==t.latestSpending?i.nullErrorValue:(0,a.number_to_amount)(t.latestSpending,"GBP"),latestEmployees:(0,a.value_to_excel)(t.latestEmployees),latestVolunteers:(0,a.value_to_excel)(t.latestVolunteers),trusteeCount:(0,a.value_to_excel)(t.trusteeCount),telephone:(0,a.value_to_excel)(t.telephone),email:(0,a.value_to_excel)(t.email),location:(0,i.mk_ExcelString)(t.location.map((function(e){return e.name})).join(",")),address:(0,i.mk_ExcelString)(t.address.streetAddress+", "+t.address.addressLocality+", "+t.address.postalCode),url:(0,a.value_to_excel)(t.url),id:(0,i.mk_ExcelString)(t.id),charityNumber:(0,a.value_to_excel)(t.charityNumber),companyNumber:(0,a.value_to_excel)(t.companyNumber),active:{type:"Boolean",basicValue:t.active},dateRegistered:(0,a.string_to_date)(t.dateRegistered),dateRemoved:null==t.dateRemoved?"not applicable":(0,a.string_to_date)(t.dateRemoved),parent:(0,a.value_to_excel)(t.parent),organisationType:(0,i.mk_ExcelString)(t.organisationType.join(",")),alternateName:(0,i.mk_ExcelString)(t.alternateName.join(",")),sources:(0,i.mk_ExcelString)(t.sources.join(",")),links:(0,i.mk_ExcelString)(t.links.map((function(e){return e.site+": "+e.url})).join(",")),orgIDs:(0,i.mk_ExcelString)(t.orgIDs.join(",")),linked_records:(0,i.mk_ExcelString)(t.linked_records.map((function(e){return e.orgid+": "+e.url})).join(",")),dateModified:(0,a.string_to_date)(t.dateModified),raw_charity_data:(0,a.value_to_excel)(t)},layouts:{compact:{icon:"Organization"},card:{title:{property:"name"},sections:[{layout:"List",properties:["description"]},{layout:"List",title:"".concat(t.active?"Active":"Inactive"," ").concat(t.organisationTypePrimary,", number ").concat(t.charityNumber," since ").concat(t.dateRegistered),properties:["id","charityNumber","companyNumber","organisationTypePrimary","active","dateRegistered","dateRemoved","parent","organisationType","alternateName"],collapsible:!0,collapsed:!0},{layout:"List",title:"People and Financials",properties:["latestFinancialYearEnd","latestIncome","latestSpending","latestEmployees","latestVolunteers","trusteeCount"],collapsible:!0,collapsed:!1},{layout:"List",title:"Contact",properties:["telephone","email","address","url"],collapsible:!0,collapsed:!1},{layout:"List",title:"More",properties:["sources","location","links","orgIDs","linked_records","dateModified","raw_charity_data"],collapsible:!0,collapsed:!0}]}},provider:{description:t.name+" on FindThatCharity",logoSourceAddress:"https://www.threesixtygiving.org/wp-content/themes/360giving2020/assets/images/360-logos/360giving-main.svg",logoTargetAddress:e}}}(t,r),l[e]=n,[2,n])}}))}))}))},6229:function(e,t){var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};function o(e){return 0==e.length?t.nullErrorValue:{type:"Array",elements:e}}function i(e){if(null==e)return t.nullErrorValue;switch(typeof e){case"boolean":return{type:"Boolean",basicValue:e};case"string":return{type:"String",basicValue:e};case"number":return{type:"Double",basicValue:e};case"object":if(e.constructor===Array){var r=e.length;if(0==r)return t.nullErrorValue;for(var n=new Array(r),s=0;s<r;s++)n[s]=[a(e[s])];return o(n)}var c=e,u="",l={};for(var p in c)if(c.hasOwnProperty(p)){for(var g=p.toLowerCase();l.hasOwnProperty(g);)g+="9";var d=c[p];l[g]=i(d);var f=typeof d,h=g+("boolean"===f||"number"===f||"string"===f?"="+d.toString():"");u=""==u?h:u+","+h}return{type:"Entity",basicType:"Error",basicValue:"#VALUE!",text:u,properties:l};default:return{type:"String",basicValue:"DEFAULT - unexpected"}}}function a(e){if(null==e)return t.nullErrorValue;var r=i(e);return"object"==typeof e&&e.constructor===Array?{type:"Entity",basicType:"Error",basicValue:"#VALUE!",text:"Nested array",properties:{array:r}}:r}function s(e){var t=new Date(e);return{type:"FormattedNumber",basicValue:25569+(t.getTime()-60*t.getTimezoneOffset()*1e3)/864e5,numberFormat:"yyyy-mm-dd"}}Object.defineProperty(t,"__esModule",{value:!0}),t.number_to_amount=t.string_to_date=t.value_to_excel=t.mk_ExcelArray=t.mk_ExcelDouble=t.mk_ExcelString=t.nullErrorValue=void 0,t.nullErrorValue={type:"Error",basicType:"Error",basicValue:"#NULL!"},t.mk_ExcelString=function(e){return{type:"String",basicValue:e}},t.mk_ExcelDouble=function(e){return{type:"Double",basicValue:e}},t.mk_ExcelArray=o,t.value_to_excel=i,t.string_to_date=s,t.number_to_amount=function(e,t){return{type:"FormattedNumber",basicValue:e,numberFormat:"GBP"==t?"£* #,##0.00":"* #,##0.00",propertyMetadata:{sublabel:t}}},CustomFunctions.associate("GET_JSON",(function(e){return r(this,void 0,void 0,(function(){var t,r,o;return n(this,(function(n){switch(n.label){case 0:t={method:"GET"},n.label=1;case 1:return n.trys.push([1,4,,5]),[4,fetch(e,t)];case 2:if(!(r=n.sent()).ok)throw new Error("Error! status: ".concat(r.status));return[4,r.json()];case 3:return[2,i(n.sent())];case 4:return o=n.sent(),console.log(o),[2,i("caught: "+o.message)];case 5:return[2]}}))}))})),CustomFunctions.associate("GET_JSON_LINES",(function(e){return r(this,void 0,void 0,(function(){var t,r,o,a,s,c,u,l;return n(this,(function(n){switch(n.label){case 0:t={method:"GET"},n.label=1;case 1:return n.trys.push([1,5,,6]),[4,fetch(e,t)];case 2:if(!(r=n.sent()).ok)throw new Error("Error! status: ".concat(r.status));return[4,r.text()];case 3:return[4,n.sent().split("\n")];case 4:for(o=n.sent(),a=o.length-1,s=new Array(a),c=0;c<a;c++){u=o[c];try{s[c]=JSON.parse(o[c])}catch(e){s[c]="error parsing: "+u+"length "+u.length}}return[2,i({lines:s})];case 5:return l=n.sent(),console.log(l),[2,i("caught: "+l.message)];case 6:return[2]}}))}))})),CustomFunctions.associate("POST_JSON",(function(e,t){return r(this,void 0,void 0,(function(){var r,o,a;return n(this,(function(n){switch(n.label){case 0:r={method:"POST",headers:{"Content-Type":"application/json"},body:t},n.label=1;case 1:return n.trys.push([1,4,,5]),[4,fetch(e,r)];case 2:if(!(o=n.sent()).ok)throw new Error("Error! status: ".concat(o.status));return[4,o.json()];case 3:return[2,i(n.sent())];case 4:return a=n.sent(),console.log(a),[2,i("caught: "+a.message)];case 5:return[2]}}))}))})),CustomFunctions.associate("ENCODEURI",(function(e){return encodeURIComponent(e)})),CustomFunctions.associate("PARSE_JSON",(function(e){return i(JSON.parse(e))})),CustomFunctions.associate("STRING_TO_DATE",s)}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}r(6229),r(80490),r(36133)}();
//# sourceMappingURL=functions.js.map